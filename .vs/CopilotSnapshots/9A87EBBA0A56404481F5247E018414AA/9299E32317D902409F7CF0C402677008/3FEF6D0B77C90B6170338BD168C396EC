// notification.js - Hệ thống thông báo chung

const Notification = {
    // Hiển thị thông báo
    show: function(message, type = 'info', duration = 3000) {
        const toastId = 'toast-' + Date.now();
        const icon = this.getIcon(type);
        const bgClass = this.getBgClass(type);
        
        const toastHtml = `
            <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="${icon} me-2"></i>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        `;
        
        const container = document.getElementById('toast-container');
        container.insertAdjacentHTML('beforeend', toastHtml);
        
        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement, {
            delay: duration
        });
        
        toast.show();
        
        // Tự động xóa khỏi DOM sau khi ẩn
        toastElement.addEventListener('hidden.bs.toast', function() {
            toastElement.remove();
        });
    },
    
    // Thông báo thành công
    success: function(message, duration = 3000) {
        this.show(message, 'success', duration);
    },
    
    // Thông báo lỗi
    error: function(message, duration = 4000) {
        this.show(message, 'error', duration);
    },
    
    // Thông báo cảnh báo
    warning: function(message, duration = 3500) {
        this.show(message, 'warning', duration);
    },
    
    // Thông báo thông tin
    info: function(message, duration = 3000) {
        this.show(message, 'info', duration);
    },
    
    // Lấy icon theo loại
    getIcon: function(type) {
        const icons = {
            'success': 'bi bi-check-circle-fill',
            'error': 'bi bi-x-circle-fill',
            'warning': 'bi bi-exclamation-triangle-fill',
            'info': 'bi bi-info-circle-fill'
        };
        return icons[type] || icons['info'];
    },
    
    // Lấy background class theo loại
    getBgClass: function(type) {
        const classes = {
            'success': 'bg-success',
            'error': 'bg-danger',
            'warning': 'bg-warning',
            'info': 'bg-info'
        };
        return classes[type] || classes['info'];
    },
    
    // Thông báo xác nhận (modal)
    confirm: function(options) {
        const defaults = {
            title: 'Xác nhận',
            message: 'Bạn có chắc chắn?',
            confirmText: 'Xác nhận',
            cancelText: 'Hủy',
            type: 'warning',
            onConfirm: function() {},
            onCancel: function() {}
        };
        
        const settings = { ...defaults, ...options };
        const modalId = 'confirm-modal-' + Date.now();
        const icon = this.getIcon(settings.type);
        const iconColor = this.getIconColor(settings.type);
        
        const modalHtml = `
            <div class="modal fade" id="${modalId}" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header border-0 pb-0">
                            <h5 class="modal-title">
                                <i class="${icon} ${iconColor} me-2"></i>${settings.title}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p class="mb-0">${settings.message}</p>
                        </div>
                        <div class="modal-footer border-0">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${settings.cancelText}</button>
                            <button type="button" class="btn btn-primary" id="${modalId}-confirm">${settings.confirmText}</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        const modalElement = document.getElementById(modalId);
        const modal = new bootstrap.Modal(modalElement);
        
        document.getElementById(modalId + '-confirm').addEventListener('click', function() {
            modal.hide();
            settings.onConfirm();
        });
        
        modalElement.addEventListener('hidden.bs.modal', function() {
            modalElement.remove();
        });
        
        modal.show();
    },
    
    // Lấy màu icon
    getIconColor: function(type) {
        const colors = {
            'success': 'text-success',
            'error': 'text-danger',
            'warning': 'text-warning',
            'info': 'text-info'
        };
        return colors[type] || colors['info'];
    }
};

// Export để sử dụng global
window.Notification = Notification;
