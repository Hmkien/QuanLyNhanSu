using Microsoft.EntityFrameworkCore;
using QuanLyNhanLuc.Models.Entities;
using QuanLyNhanLuc.Models.Enums;

namespace QuanLyNhanLuc.Data;

public static class DbInitializer
{
    public static void Initialize(QLNLContext context)
    {
        // Đảm bảo database đã được tạo
        _ = context.Database.EnsureCreated();

        // Kiểm tra xem đã có dữ liệu chưa
        if (context.PhongBans.Any())
        {
            return; // Database đã được seed
        }

        // Thêm dữ liệu mẫu cho PhongBan
        PhongBan[] phongBans = new PhongBan[]
        {
            new() { MaPhongBan = "FE", TenPhongBan = "Frontend", MoTa = "Phòng phát triển Frontend" },
            new() { MaPhongBan = "BE", TenPhongBan = "Backend", MoTa = "Phòng phát triển Backend" },
            new() { MaPhongBan = "QA", TenPhongBan = "Quality Assurance", MoTa = "Phòng kiểm thử chất lượng" },
            new() { MaPhongBan = "HR", TenPhongBan = "Human Resources", MoTa = "Phòng nhân sự" }
        };
        context.PhongBans.AddRange(phongBans);
        _ = context.SaveChanges();

        // Thêm dữ liệu mẫu cho NhanSu
        NhanSu[] nhanSus = new NhanSu[]
        {
            new() { MaNhanVien = "NS001", HoVaTen = "Nguyễn Văn A", PhongBanId = phongBans[0].Id },
            new() { MaNhanVien = "NS002", HoVaTen = "Trần Thị B", PhongBanId = phongBans[1].Id },
            new() { MaNhanVien = "NS003", HoVaTen = "Lê Văn C", PhongBanId = phongBans[2].Id },
            new() { MaNhanVien = "NS004", HoVaTen = "Phạm Thị D", PhongBanId = phongBans[3].Id }
        };
        context.NhanSus.AddRange(nhanSus);
        _ = context.SaveChanges();

        // Thêm dữ liệu mẫu cho ChamCong
        // After saving NhanSu, their Ids are generated. Create ChamCong referencing those Ids.
        ChamCong[] chamCongs = new ChamCong[]
        {
            new() {
                NhanSuId = nhanSus[0].Id,
                NgayChamCong = new DateTime(2023, 7, 1),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            },
            new() {
                NhanSuId = nhanSus[0].Id,
                NgayChamCong = new DateTime(2023, 7, 2),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            },
            new() {
                NhanSuId = nhanSus[0].Id,
                NgayChamCong = new DateTime(2023, 7, 3),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            },
            new() {
                NhanSuId = nhanSus[1].Id,
                NgayChamCong = new DateTime(2023, 7, 1),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            },
            new() {
                NhanSuId = nhanSus[1].Id,
                NgayChamCong = new DateTime(2023, 7, 2),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            },
            new() {
                NhanSuId = nhanSus[1].Id,
                NgayChamCong = new DateTime(2023, 7, 3),
                GioVao = new TimeSpan(8, 0, 0),
                GioRa = new TimeSpan(17, 0, 0),
                TrangThai = TrangThaiChamCong.DiLam,
                GhiChu = "Đi làm đúng giờ"
            }
        };
        context.ChamCongs.AddRange(chamCongs);
        _ = context.SaveChanges();

        // Thêm dữ liệu mẫu cho LichLamThem
        LichLamThem[] lichLamThems = new LichLamThem[]
        {
            new() {
                NhanSuId = nhanSus[2].Id,
                NgayLamThem = new DateTime(2023, 7, 4),
                GioBatDau = new TimeSpan(18, 0, 0),
                GioKetThuc = new TimeSpan(21, 0, 0),
                LyDo = "Hoàn thành dự án gấp",
                TrangThai = TrangThaiLamThem.ChuaDuyet,
                NguoiDuyet = "Admin"
            },
            new() {
                NhanSuId = nhanSus[3].Id,
                NgayLamThem = new DateTime(2023, 7, 5),
                GioBatDau = new TimeSpan(18, 0, 0),
                GioKetThuc = new TimeSpan(22, 0, 0),
                LyDo = "Họp dự án",
                TrangThai = TrangThaiLamThem.DaDuyet,
                NguoiDuyet = "Admin"
            }
        };
        context.LichLamThems.AddRange(lichLamThems);
        _ = context.SaveChanges();
    }
}