@using X.PagedList
@using X.PagedList.Mvc.Core
@model IEnumerable<QuanLyNhanLuc.Models.ViewModels.NhanVienListVM>

@{
    ViewData["Title"] = "Danh sách nhân viên";
}

<style>
    .employee-name-link {
        color: #ff6600;
        cursor: pointer;
        text-decoration: none;
        font-weight: 500;
    }
    .employee-name-link:hover {
        text-decoration: underline;
        color: #ff8833;
    }
    .status-badge {
        padding: 5px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
    }
</style>

<div class="row mb-3 align-items-center">
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb custom-breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a class="text-decoration-none text-secondary" href="/">
                        <i class="bi bi-house-door"></i>
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a class="text-decoration-none text-secondary" href="#">Hồ sơ nhân sự</a>
                </li>
                <li class="breadcrumb-item active text-primary" aria-current="page">Danh sách nhân viên</li>
            </ol>
        </nav>
    </div>
</div>

<div class="d-flex justify-content-between gap-4 mb-4">
    <h2 class="text-primary">Danh sách nhân viên</h2>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary"><i class="bi bi-box-arrow-right me-2"></i>Nhập excel</button>
        <button class="btn btn-outline-primary"><i class="bi bi-file-earmark-excel me-2"></i>Xuất excel</button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#themNhanVienModal">
            <i class="fas fa-plus me-2"></i>Thêm mới
        </button>
    </div>
</div>

<!-- Search Form -->
<div class="mb-3">
    <div class="card-body py-2">
        <form method="get" asp-action="DanhSachNhanVien" class="row g-2 align-items-center">
            <div class="col-md-3">
                <select name="gioiTinh" class="form-select form-select-sm">
                    <option value="">-- Chọn giới tính --</option>
                    <option value="Nam" @(ViewBag.GioiTinh == "Nam" ? "selected" : "")>Nam</option>
                    <option value="Nữ" @(ViewBag.GioiTinh == "Nữ" ? "selected" : "")>Nữ</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="phongBanId" class="form-select form-select-sm">
                    <option value="">-- Chọn phòng ban --</option>
                    @* Load danh sách phòng ban từ ViewBag *@
                </select>
            </div>
            <div class="col-md-4">
                <div class="input-group input-group-sm">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" name="search" class="form-control" placeholder="Tìm kiếm tên, CCCD, email, SĐT..." value="@ViewBag.Search" />
                </div>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-search me-1"></i>Tìm kiếm</button>
                <a asp-action="DanhSachNhanVien" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-clockwise me-1"></i>Làm mới</a>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th><input type="checkbox"></th>
                    <th>STT</th>
                    <th>Tên nhân viên</th>
                    <th>CMND/CCCD</th>
                    <th>Giới tính</th>
                    <th>Phòng ban</th>
                    <th>Chức vụ</th>
                    <th>Email / SĐT</th>
                    <th class="text-center">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var stt = (ViewBag.CurrentPage - 1) * ViewBag.PageSize + 1;
                }
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="text-center"><input type="checkbox"></td>
                        <td class="text-dark">@stt</td>
                        <td>
                            <a href="javascript:void(0)" class="employee-name-link" data-action="view-detail" data-id="@item.Id">
                                @item.FullName
                            </a>
                        </td>
                        <td class="text-dark">@item.IdentityNumber</td>
                        <td class="text-dark">@item.GioiTinhStxt</td>
                        <td class="text-dark">@item.DepartmentName</td>
                        <td class="text-dark">@item.PositionName</td>
                        <td class="text-dark">@item.Email / @item.PhoneNumber</td>
                        <td class="text-center">
                            <a href="javascript:void(0)" data-action="edit" data-id="@item.Id" title="Sửa" class="me-2">
                                <i class="bi bi-pen text-primary"></i>
                            </a>
                            <a href="javascript:void(0)" data-action="delete" data-id="@item.Id" title="Xóa">
                                <i class="bi bi-trash text-danger"></i>
                            </a>
                        </td>
                    </tr>
                    stt++;
                }
            </tbody>
        </table>
    </div>
</div>

<div class="d-flex justify-content-between align-items-center">
    <div>
        <select class="form-select d-inline-block text-primary" style="width: auto;">
            <option>20</option>
            <option>50</option>
            <option>100</option>
        </select>
        <span class="ms-2 text-primary">Tổng số bản ghi: @Model.Count()</span>
    </div>
    <nav>
        <ul class="pagination custom-pagination mb-0">
            <li class="page-item">
                <a class="page-link rounded-circle" href="#"><i class="bi bi-chevron-left"></i></a>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item active"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
            <li class="page-item"><a class="page-link" href="#">8</a></li>
            <li class="page-item"><a class="page-link" href="#">9</a></li>
            <li class="page-item"><a class="page-link" href="#">10</a></li>
            <li class="page-item">
                <a class="page-link rounded-circle" href="#"><i class="bi bi-chevron-right"></i></a>
            </li>
        </ul>
    </nav>
</div>
</div>

<div id="modalContainer"></div>
<div id="deleteModalContainer"></div>

@section Scripts {
<script>
    $(document).ready(function() {
        // Xử lý sự kiện click nút thêm mới
        $('.btn-primary[data-bs-target="#themNhanVienModal"]').click(function(e) {
            e.preventDefault();
            loadModalThemNhanSu();
        });

        // Xử lý sự kiện click nút xóa
        $(document).on('click', '.delete-btn', function(e) {
            e.preventDefault();
            var id = $(this).data('id');
            loadModalConfirmDelete(id);
        });
    });

    function loadModalThemNhanSu() {
        $.get('/NhanSu/GetModalThemNhanSu', function(data) {
            $('#modalContainer').html(data);
            // Delay nhỏ để đảm bảo DOM đã sẵn sàng
            setTimeout(function() {
                var modalElement = document.getElementById('themNhanVienModal');
                if (modalElement) {
                    var modal = new bootstrap.Modal(modalElement, {
                        backdrop: 'static',
                        keyboard: false
                    });
                    modal.show();
                } else {
                    console.error('Modal element not found');
                }
            }, 100);
        }).fail(function(xhr, status, error) {
            console.error('Error loading modal:', error);
            Notification.error('Không thể tải form thêm nhân viên: ' + error);
        });
    }

    function loadModalConfirmDelete(id) {
        $.get('/NhanSu/GetModalConfirmDelete/' + id, function(data) {
            $('#deleteModalContainer').html(data);
            setTimeout(function() {
                var modalElement = document.getElementById('confirmDeleteModal');
                if (modalElement) {
                    var modal = new bootstrap.Modal(modalElement);
                    modal.show();
                }
            }, 100);
        }).fail(function(xhr, status, error) {
            console.error('Error loading delete modal:', error);
            Notification.error('Không thể tải modal xác nhận');
        });
    }
    </script>
}
